<div class="todo-wrapper">
  <div class="header-section">
    <div class="title-container">
      <h2>📋 To-Do Listesi</h2>
    </div>
    <button class="add-todo-btn" (click)="openAddDialog()">
      <span class="plus-icon">＋</span>
      <span class="btn-text">Yeni Görev</span>
    </button>
  </div>

  <div *ngIf="error" class="alert">{{ error }}</div>

  <div class="todo-list-section">
    <div class="filters-compact">
      <div class="filter-buttons">
        <button [class.active]="filter==='all'" (click)="setFilter('all')">Tümü ({{ totalCount }})</button>
        <button [class.active]="filter==='active'" (click)="setFilter('active')">Aktif ({{ activeCount }})</button>
        <button [class.active]="filter==='completed'" (click)="setFilter('completed')">Tamamlanan ({{ completedCount }})</button>
      </div>
    </div>

    <ul class="list-group" 
        cdkDropList 
        (cdkDropListDropped)="onTodoDrop($event)"
        cdkDropListLockAxis="y">
      <li *ngFor="let todo of filteredTodos()" 
          class="list-group-item" 
          [class.completed]="todo.isCompleted"
          cdkDrag>
        
        <div class="drag-handle" 
             cdkDragHandle 
             title="Sürükleyerek sırayı değiştir">
          <span class="handle-dots">⋮⋮</span>
        </div>
        
        <div class="todo-content">
          <div class="left">
            <button class="check" (click)="toggleTodoCompletion(todo, $event)" aria-label="Tamamla/geri al">
              {{ todo.isCompleted ? '✓' : '' }}
            </button>
            <div class="texts">
              <strong>{{ todo.title }}</strong>
              <span *ngIf="todo.description"> — {{ todo.description }}</span>
            </div>
          </div>
          <div class="actions">
            <button class="btn-edit" (click)="editTodo(todo, $event)" title="Düzenle"><span>✏️</span></button>
            <button class="btn-delete" (click)="deleteTodo(todo.id, $event)" title="Sil"><span>🗑️</span></button>
          </div>
        </div>
      </li>
    </ul>

    <div *ngIf="!filteredTodos().length" class="empty">
      <div class="empty-content">
        <div class="empty-icon">📋</div>
        <h3>Henüz görev yok</h3>
        <p>{{ getEmptyMessage() }}</p>
      </div>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showAddDialog" (click)="closeAddDialog()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingTodo ? 'Görevi Düzenle' : 'Yeni Görev Ekle' }}</h3>
        <button class="close-btn" (click)="closeAddDialog()">×</button>
      </div>
      <form (ngSubmit)="onSubmit()" #todoForm="ngForm" class="modal-form">
        <div class="form-group">
          <label for="title">Başlık *</label>
          <input type="text" id="title" name="title" [(ngModel)]="newTodo.title" placeholder="Görev başlığı" class="form-input" required #titleInput>
        </div>
        <div class="form-group">
          <label for="description">Açıklama</label>
          <textarea id="description" name="description" [(ngModel)]="newTodo.description" placeholder="Görev açıklaması (opsiyonel)" class="form-textarea" rows="3"></textarea>
        </div>
        <div class="form-group" *ngIf="editingTodo">
          <label class="checkbox-label">
            <input type="checkbox" name="isCompleted" [(ngModel)]="newTodo.isCompleted" class="form-checkbox">
            <span class="checkmark"></span>
            Tamamlandı olarak işaretle
          </label>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeAddDialog()">⌫ İptal</button>
          <button type="submit" class="btn-save" [class.loading]="loading">
            <span *ngIf="loading">💾 Kaydediliyor...</span>
            <span *ngIf="!loading">{{ editingTodo ? '✅ Güncelle' : '➕ Ekle' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>